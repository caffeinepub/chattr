{
  "kind": "build_request",
  "title": "Re-add sequential message IDs to all messages",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add a global message ID counter in the backend that starts at 1 and increments sequentially for every message created (including creator posts and all replies across all chatrooms)",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "Unique sitewide IDs - one global counter that increments across all threads and messages"
        ]
      },
      "acceptanceCriteria": [
        "A single global counter exists in the backend state that tracks the next message ID to assign",
        "The counter increments by 1 for every new message regardless of chatroom",
        "The counter persists across canister upgrades"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add an id field of type Text to the Message type in the backend that stores the formatted message ID",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "The ID will be stored in the backend"
        ]
      },
      "acceptanceCriteria": [
        "The Message type includes an id field",
        "The id field is populated when a message is created",
        "The id is included when messages are returned from backend queries"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Format message IDs as zero-padded 9-digit strings (e.g., '000000001', '000000042'), automatically expanding to 10+ digits when the counter exceeds 999999999",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "9-digit format - starting at 000000001, incrementing sequentially",
          "Auto-expanding digits - if we exceed 999999999, it'll become 10 digits, then 11, etc."
        ]
      },
      "acceptanceCriteria": [
        "Message ID 1 is formatted as '000000001'",
        "Message ID 999999999 is formatted as '999999999'",
        "Message ID 1000000000 is formatted as '1000000000' (10 digits)",
        "The formatting logic handles arbitrarily large numbers"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Display the message ID in the MessageBubble component for all messages, styled to match 4chan's post numbering system appearance",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "displayed with each message, just like 4chan's post numbering system"
        ]
      },
      "acceptanceCriteria": [
        "The message ID is visible in every message bubble",
        "The ID is displayed near the timestamp or username",
        "The styling is consistent with the rest of the message header"
      ]
    },
    {
      "id": "REQ-5",
      "text": "Do not add any authorization checks or caller verification for message ID assignment",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-last"
        ],
        "quotes": [
          "No authorization checks - no caller verification or permission logic"
        ]
      },
      "acceptanceCriteria": [
        "Message IDs are assigned without checking caller identity",
        "No permission logic is added for ID generation"
      ]
    }
  ],
  "constraints": [
    "Do not modify any existing CSS or Tailwind styling outside of adding message ID display",
    "Maintain the single global counter across all chatrooms and message types"
  ],
  "nonGoals": [
    "Message ID collision detection or duplicate prevention",
    "Custom ID prefixes or suffixes per chatroom",
    "Editable or reassignable message IDs"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}