{
  "kind": "build_request",
  "title": "Fix image and GIF display in chat message bubbles",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update MessageBubble.tsx to restore image and GIF display functionality using the working approach from draft version 261, ensuring both static images and animated GIFs render correctly in chat bubbles",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5",
          "msg-6",
          "msg-7"
        ],
        "quotes": [
          "images/gifs are not displaying in chat bubbles",
          "I can see the old MessageBubble.tsx from version 261. This component handles image display through the `useGetImage` hook with the `imageId` field, and it renders uploaded images with `imageUrl` from the blob's `getDirectURL()` method"
        ]
      },
      "acceptanceCriteria": [
        "Images with imageId load and display correctly in message bubbles using the useGetImage hook",
        "Images with imageUrl load and display correctly in message bubbles using direct blob URLs",
        "Animated GIFs display and animate properly in chat messages",
        "All existing MessageBubble functionality (reactions, replies, media embeds, pinning) continues to work",
        "Image loading errors are handled gracefully"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update any frontend query hooks in useQueries.ts related to image fetching to ensure they properly support the image display functionality restored in MessageBubble.tsx",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "do I need to update the backend Motoko code, the image upload logic, or any query hooks to support proper image loading?"
        ]
      },
      "acceptanceCriteria": [
        "useGetImage hook (if it exists) properly fetches images from the backend using imageId",
        "Image query hooks handle loading states and errors appropriately",
        "Query hooks integrate correctly with MessageBubble.tsx image rendering logic"
      ]
    }
  ],
  "constraints": [
    "Do not modify any backend Motoko code - backend is working correctly",
    "Preserve all existing MessageBubble.tsx functionality including reactions, replies, media embeds, Twitter widgets, and pinning",
    "Use the image loading approach from draft version 261 as the reference implementation"
  ],
  "nonGoals": [
    "Backend changes or modifications to main.mo",
    "Changes to image upload functionality",
    "New image features beyond restoring existing display functionality",
    "Modifications to other chat components beyond MessageBubble.tsx and related query hooks"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}