{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Purge persisted empty ['chatrooms'] React Query cache on actor-ready to force fresh lobby load",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "On initial actor-ready load in production, detect and purge/ignore a persisted empty-array cache for the canonical React Query key ['chatrooms'] and force a fresh refetch so lobby rooms render immediately.",
      "acceptanceCriteria": [
        "On a production session where the browser has an existing cached value of [] for the ['chatrooms'] query, the lobby shows real rooms (if any exist in the backend) on initial load without requiring a search or category click.",
        "The fix only targets the canonical lobby query key ['chatrooms'] cache behavior on initial load; search/category filtering continues to work as before.",
        "The implementation is applied in the existing actor-ready recovery flow (used by LobbyPage via useForceFreshChatroomsOnActorReady) and does not require backend changes."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useForceFreshChatroomsOnActorReady.ts",
          "operation": "modify",
          "description": "Update the actor-ready recovery sequence to explicitly handle the canonical ['chatrooms'] key: on first actor-ready in production, if the current cache value for ['chatrooms'] is an empty array, treat it as a bad persisted value by removing/resetting that query state (only for the exact key ['chatrooms']) and then forcing an immediate refetch (even if inactive). Keep existing behavior for legacy empty search/category keys and ensure the change does not impact search/category filtering keys."
        }
      ]
    }
  ]
}